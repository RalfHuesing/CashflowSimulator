<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:fi="using:FluentIcons.Avalonia"
             xmlns:vm="using:CashflowSimulator.Desktop.Features.Main"
             xmlns:nav="using:CashflowSimulator.Desktop.Features.Main.Navigation"
             xmlns:primitives="using:Avalonia.Controls.Primitives"
             mc:Ignorable="d" d:DesignWidth="1000" d:DesignHeight="600"
             x:Class="CashflowSimulator.Desktop.Features.Main.MainShellView"
             x:DataType="vm:MainShellViewModel">

    <Grid ColumnDefinitions="260, *">
        
        <Border Grid.Column="0" 
                Background="{DynamicResource SidebarBackgroundBrush}"
                Padding="{DynamicResource PagePadding}">
            <Grid RowDefinitions="Auto, *, Auto">
                
                <StackPanel Grid.Row="0" Orientation="Horizontal" 
                            Spacing="{StaticResource SpacingSmallValue}" 
                            Margin="{StaticResource SidebarLogoMargin}">
                    <fi:SymbolIcon Symbol="ArrowTrendingLines" 
                                   FontSize="{StaticResource SidebarLogoIconSize}" 
                                   Foreground="{DynamicResource PrimaryActionBrush}"/>
                    <TextBlock Text="CashflowSimulator" Classes="sidebar-logo-title"/>
                </StackPanel>

                <nav:NavigationView Grid.Row="1" DataContext="{Binding Navigation}"/>

                <StackPanel Grid.Row="2" Spacing="{StaticResource SpacingSmallValue}">
                    <TextBlock Text="SZENARIO" Classes="sidebar-section-caption"/>
                    
                    <Button Classes="ghost" Command="{Binding LoadCommand}" HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <fi:SymbolIcon Symbol="FolderOpen" />
                            <TextBlock Text="Laden..." />
                        </StackPanel>
                    </Button>

                    <Button Classes="ghost" Command="{Binding SaveCommand}" HorizontalAlignment="Stretch">
                        <StackPanel Orientation="Horizontal" Spacing="12">
                            <fi:SymbolIcon Symbol="Save" />
                            <TextBlock Text="Speichern" />
                        </StackPanel>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

        <Border Grid.Column="1" 
                Background="{DynamicResource ContentBackgroundBrush}"
                Padding="{DynamicResource PagePadding}">
            <Grid RowDefinitions="*, 36">
                <Border Grid.Row="0" Classes="card">
                    <Grid>
                        <StackPanel IsVisible="{Binding IsContentPlaceholderVisible}"
                                    Spacing="{StaticResource SpacingMediumValue}"
                                    VerticalAlignment="Center" HorizontalAlignment="Center">
                            <fi:SymbolIcon Symbol="ArrowTrendingLines"
                                           FontSize="{StaticResource PlaceholderIconSize}"
                                           Foreground="{DynamicResource PlaceholderIconBrush}"/>
                            <TextBlock Text="WÃ¤hlen Sie eine Aktion aus der Navigation." 
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="{Binding CurrentFilePath, StringFormat='Datei: {0}', TargetNullValue='(Ungespeichert)'}"
                                       Classes="placeholder-secondary"
                                       HorizontalAlignment="Center"/>
                        </StackPanel>
                        <ContentControl Content="{Binding CurrentContentViewModel}"
                                         IsVisible="{Binding !IsContentPlaceholderVisible}"
                                         HorizontalContentAlignment="Stretch"
                                         VerticalContentAlignment="Stretch"/>
                    </Grid>
                </Border>
                <Border x:Name="StatusBarHost" Grid.Row="1" Background="Transparent"
                        PointerPressed="StatusBarHost_OnPointerPressed">
                    <primitives:FlyoutBase.AttachedFlyout>
                        <Flyout Placement="Top" ShowMode="Transient">
                            <ScrollViewer MaxHeight="200" VerticalScrollBarVisibility="Auto">
                                <StackPanel Spacing="4" Margin="12,8">
                                    <TextBlock Text="Validierungsfehler" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                    <ItemsControl ItemsSource="{Binding ValidationMessages}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding DisplayText}" TextWrapping="Wrap" FontSize="13"/>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </ScrollViewer>
                        </Flyout>
                    </primitives:FlyoutBase.AttachedFlyout>
                    <Grid>
                        <Border Classes="status-bar" IsVisible="{Binding !HasValidationMessages}">
                            <TextBlock Text="{Binding StatusBarDisplayText}" Classes="status-bar-text"/>
                        </Border>
                        <Border Classes="status-bar-error" IsVisible="{Binding HasValidationMessages}">
                            <TextBlock Text="{Binding StatusBarDisplayText}" Classes="status-bar-text-error"/>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>